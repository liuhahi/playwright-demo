from typing import List

from pydantic import BaseModel, Field


class Vulnerability(BaseModel):
    id: str = Field(
        description="Vulnerability identifier (concise 10-word description like 'SQL Injection in login username parameter bypassing authentication')")
    description: str = Field(description=(
        "Concise vulnerability summary: endpoint (method + path or URL), vuln type, affected params/headers/body fields, direct impact (data exposure, auth bypass, code exec). Provide one clear sentence example if helpful."
    ))
    reason: str = Field(description=(
        "Evidence proving the vuln: payload used, full request (method, URL, key headers, body), response snippet showing impact, short step sequence (send -> observe -> conclude). Must be reproducible and specific."
    ))
    severity: str = Field(description="Severity (critical|high|medium|low) based on impact & ease of exploitation",
                          default="medium")
    exploit_code: str = Field(description=(
        "Markdown proof-of-exploit. Required headings: Environment | Steps | Commands & Outputs | PoC Code | Success Indicators | Impact | Cleanup | Scope.\n"
        "Each step: exact command or raw HTTP + trimmed output with success markers (#). Redact secrets: first6...last4. Show minimal runnable PoC script if code applies.\n"
        "Success indicators: concrete artifacts (e.g. unauthorized JSON fields, dumped row count, executed payload).\n"
        "Fail if missing outputs, vague placeholders, or no clear success indicators."
    ))


class Vulnerabilities(BaseModel):
    vulnerabilities: List[Vulnerability] = Field(
        description="List of CONFIRMED vulnerabilities with full exploitation metadata. "
                    "CRITICAL: Only include vulnerabilities that have been successfully exploited with concrete proof. "
                    "Do NOT include potential issues, suspicious findings, false positives, or unverified vulnerabilities. "
                    "Return empty list if no confirmed exploitable vulnerabilities were found."
    )